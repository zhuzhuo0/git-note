## Node单线程、事件驱动、非阻塞I/O

##### 一、单线程、非阻塞I/O、事件驱动

这是nodejs的三个特点。

1. 单线程
    Nodejs是单线程，和多线程相比：
    优点：可以避免系统分配多线程以及线程间通信时的开销，可以更高效的利用cpu，降低内存的耗用。
    缺点：一旦出现错误会导致整个程序崩溃，不擅长大量的计算，无法利用多核cpu（貌似现在也有办法）
2. 非阻塞I/O
    非阻塞I/O从名字上便可以理解，为了提高程序的性能，更好的提高线程的利用率，尽量不让线程空闲着。
    　　比如我们想要读取一个文件，然后再进行一些操作，当然这些操作的前提条件是不需要这个文件的数据，这个时候我们便可以让系统的某个线程去读取文件，同时程序的主线程继续执行下面的操作，程序并不会等待文件读取完毕才继续执行，这就像我们常用的ajax
3. 事件驱动
    　　Nodejs提供的绝大多数API都是基于事件的、异步的风格，就是服务器程序的入口也是从connect事件开始。
    　　还是继续上面的读取文件的例子，假如我要读取一个文件，然后要打印出文件的内容，那么读取文件便是一个事件（readFile)，而打印的操作要在事件的回调函数中执行。
    　　在这里又涉及到了事件队列和事件循环：
    　　程序主线程顺序执行，当遇到一个事件时会将其添加进事件队列，Nodejs底层的libuv库（不要问我这是什么鬼，底层的东西看着都吓人）负责将事件队列中不同的事件任务分配给不同的线程去执行，执行的结果再重新返回给用户，这便是事件循环。
    　　为什么Nodejs是单线程的，却在这里又变成了多线程，**其实Nodejs对外展示是单线程的，但内部其实是多线程的，Node本身的主线程主要就是起不断往返调度的作用** 

##### 二、例子更好理解

说了这么多，比个例子吧。我在网上定了个外卖，老板在店里安排人给我派送，定完外卖之后开始打游戏，正打着激烈的时候派送员来了，玩的正嗨呢，没空开门，结果派送员在门外等了1一分钟才去开门，至此我定外卖的这个过程也就结束了。
 　　在这个例子中我就相当于主线程，我定了外卖后这个单子就会加入到店铺的订单列表，就相当于一个事件加入到了事件队列，老板就是这个libuv，他在店里运筹帷幄安排人员给我做饭，然后送外卖，即分配线程执行事件任务，当送回来时如果我是空闲的我就会立刻开门收快递，但是当时我正忙着（打游戏很重要），所以派送员久等了一会，即事件执行之后的回调函数是否会立即执行要看主线程是否空闲。

##### 三、总结

1. Node 表面上是单线程，其实内部仍然是多线程的，主线程起往返调度
2. 单线程、事件驱动、非阻塞I/O,我的理解是事件驱动只是为了实现非阻塞的方式，非阻塞才是目的